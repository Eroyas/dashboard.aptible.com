<div class="row">
  <div class="col-xs-12 flex-row">
    <form class="flex-row-item">
      <h3 class="heading--caps heading--sm">Add Existing User</h3>
      <div class="invite-user">
        <button class="btn btn-primary" {{action "inviteUser" invitedUser}} type="submit">Add</button>
        <div class="user-select-container">
          {{ultimate-select
            class="user-select" name="billing-contact" prompt="Select..."
            items=nonmembers itemKey="id" itemValue="name"
            update=(action (mut invitedUser)) selected=invitedUser}}
        </div>
      </div>
    </form>

    <h3 class="flex-row-item heading--caps heading--sm">OR</h3>

    <form class="flex-row-item" role='form' {{action "inviteByEmail" inviteByEmail on="submit"}}>
      {{server-validation-errors model=invitation}}
      <h3 class="heading--caps heading--sm">Invite By Email</h3>
      <div class="invite-user">
        <button class="btn btn-primary" {{action "inviteByEmail" invitedEmail}} type="submit">Send Invite</button>
        <div class="invite-user-container">
          {{input name='invite-by-email' value=invitedEmail classNames="form-control"}}
        </div>
      </div>
    </form>
  </div>
</div>

<hr>

<!-- TODO: Search
<form>
  <label class="aptible-label">Search Members</label>
  <input type="search">
</form> -->

<div class="row">
  <div class="col-xs-12">
    <h3 class="heading--caps heading--sm">Members</h3>

    <table class="aptable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Date Added</th>
          <th>Owner</th>
          <th>Admin Members</th>
          {{#aptible-ability user=session.currentUser scope='manage' permittable=organization as |hasAbility|}}
            {{#if hasAbility}}
              <th>Actions</th>
            {{/if}}
          {{/aptible-ability}}
        </tr>
      </thead>

      <tbody>
        {{#if sortedMemberships}}
          {{#each sortedMemberships as membership}}
            {{partial 'role/membership-table-row'}}
          {{/each}}
        {{else}}
          <td class="aptable--empty" colspan="6">
            {{role.name}} currently has no members.
          </td>
        {{/if}}
      </tbody>
    </table>
  </div>
</div>

{{#if pendingInvitations}}
  <div class="row">
    <div class="col-xs-12">
      <h3 class="heading--caps heading--sm">Pending Invites</h3>

      <table class="aptable">
        <thead>
          <tr>
            <th>Email</th>
            <th>Role</th>
            <th>Invited By</th>
            <th>Invited On</th>
            {{!#aptible-ability user=session.currentUser scope='manage' permittable=organization as |hasAbility|}}
              {{!#if hasAbility}}
                <th>Actions</th>
              {{!/if}}
            {{!/aptible-ability}}
          </tr>
        </thead>

        <tbody>
          {{#each pendingInvitations as invitation}}
            {{partial 'organization/invited-user-table-row' current-user=session.currentUser}}
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
{{/if}}
